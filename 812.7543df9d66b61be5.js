"use strict";(self.webpackChunkWorkoutFormula=self.webpackChunkWorkoutFormula||[]).push([[812],{8812:(Re,W,w)=>{w.r(W),w.d(W,{HomeModule:()=>Je});var Z=w(95),T=w(157),e=w(5879),b=w(3076),J=w(5619),R=w(9862);let M=(()=>{var i;class u{constructor(t){this.http=t,this._changeView=new J.X(null),this.changeView=this._changeView.asObservable(),this.routineUrl="https://shogunremakeapi.azurewebsites.net/api/routines",this.workoutUrl="https://shogunremakeapi.azurewebsites.net/api/workouts"}getFeaturedRoutines(){return this.http.get(this.routineUrl+"/featured")}getFeaturedWorkouts(){return this.http.get(this.workoutUrl+"/featured")}getSearchBarRoutineNames(){return this.http.get(this.routineUrl+"/publishedNames")}clearViewChange(){this._changeView.next(null)}viewChange(t){this._changeView.next(t)}}return(i=u).\u0275fac=function(t){return new(t||i)(e.LFG(R.eN))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),u})();var O=w(2931),x=w(6814);function F(i,u){if(1&i&&(e.TgZ(0,"div",16),e._uU(1),e.qZA()),2&i){const o=u.$implicit;e.xp6(1),e.Oqu(o)}}const A=function(i,u,o,t){return{"highlighted-date":i,today:u,otherMonth:o,selected:t,day:!0}};function D(i,u){if(1&i){const o=e.EpF();e.TgZ(0,"div",17),e.NdJ("click",function(){const r=e.CHM(o),a=r.$implicit,s=r.index,c=e.oxw(2);return e.KtG(c.showWorkout(a.year,a.month,a.date,s))}),e._uU(1),e.qZA()}if(2&i){const o=u.$implicit,t=e.oxw(2);e.Q6J("ngClass",e.l5B(2,A,t.isDateInDb(o.year,o.month,o.date),t.isToday(o),o.otherMonth,o.selected)),e.xp6(1),e.hij(" ",o.date," ")}}function I(i,u){if(1&i){const o=e.EpF();e.TgZ(0,"div",20),e.NdJ("click",function(){const a=e.CHM(o).$implicit,s=e.oxw(3);return e.KtG(s.editWorkout(a.id))}),e.TgZ(1,"div",21),e._uU(2),e.qZA(),e.TgZ(3,"div",22),e._uU(4,"\uf054"),e.qZA(),e.TgZ(5,"div",23),e._uU(6),e.ALo(7,"date"),e.qZA()()}if(2&i){const o=u.$implicit;e.xp6(2),e.Oqu(o.name),e.xp6(4),e.Oqu(e.xi3(7,2,o.date,"fullDate"))}}function E(i,u){if(1&i&&(e.TgZ(0,"div",18),e.YNc(1,I,8,5,"div",19),e.qZA()),2&i){const o=e.oxw(2);e.xp6(1),e.Q6J("ngForOf",o.selectedWorkout)}}const q=function(){return["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]};function U(i,u){if(1&i){const o=e.EpF();e.TgZ(0,"div",1)(1,"div",2)(2,"div",3),e._uU(3,"Workout Schedule"),e.qZA(),e.TgZ(4,"div",4),e._uU(5," i "),e.qZA()(),e.TgZ(6,"div",5)(7,"div",6),e.NdJ("click",function(){e.CHM(o);const r=e.oxw();return e.KtG(r.prevMonth())}),e._UZ(8,"i",7),e.qZA(),e.TgZ(9,"div",8),e.NdJ("click",function(){e.CHM(o);const r=e.oxw();return e.KtG(r.test())}),e._uU(10),e.qZA(),e.TgZ(11,"div",9),e.NdJ("click",function(){e.CHM(o);const r=e.oxw();return e.KtG(r.nextMonth())}),e._UZ(12,"i",10),e.qZA()(),e.TgZ(13,"div",11),e.YNc(14,F,2,1,"div",12),e.qZA(),e.TgZ(15,"div",13),e.YNc(16,D,2,7,"div",14),e.qZA(),e.YNc(17,E,2,1,"div",15),e.qZA()}if(2&i){const o=e.oxw();e.xp6(10),e.hij(" ",o.getMonthAndYear()," "),e.xp6(4),e.Q6J("ngForOf",e.DdM(4,q)),e.xp6(2),e.Q6J("ngForOf",o.days),e.xp6(1),e.Q6J("ngIf",o.selectedWorkout.length>0)}}let B=(()=>{var i;class u{constructor(t,r){this.userService=t,this.routineService=r,this.selectedWorkout=[],this.workouts=[],this.days=[],this.today=new Date,this.datesFromDb=[],this.upcommingWorkouts=[];const a=new Date;this.month=a.getMonth(),this.year=a.getFullYear(),this.updateDays()}ngOnInit(){this.userService.currentUser.subscribe(t=>{this.userSettings=t,!t.stillCreatingRoutine&&t.routineId&&(this.routineService.getCurrentProgram(this.userSettings.routineId),this.getCalendarWorkouts())})}test(){}getCalendarWorkouts(){this.routineService.calendarWorkouts.subscribe(t=>{if(this.workouts=t,t){this.datesFromDb=t.map(c=>new Date(c.date)),this.workouts.filter(c=>!1===c.completed);let a=new Date;a.setHours(0,0,0,0),this.datesFromDb.findIndex(c=>(c.setHours(0,0,0,0),c.getTime()===a.getTime()))}})}showWorkout(t,r,a,s){this.currentSelectedIndex?(this.days[this.currentSelectedIndex].selected=!1,this.days[s].selected=!0):this.days[s].selected=!0,this.currentSelectedIndex=s;const c=new Date(t,r,a);c.setHours(0,0,0,0);let n=this.datesFromDb.findIndex(g=>(g.setHours(0,0,0,0),g.getTime()===c.getTime()));(n||0==n)&&this.selectedWorkout.splice(0,1,this.workouts[n]),-1==n&&(this.selectedWorkout=[])}editWorkout(t){}onCreateNew(t){}updateDays(){const t=new Date(this.year,this.month,1).getDay(),r=new Date(this.year,this.month+1,0).getDate(),a=new Date(this.year,this.month,0).getDate();this.days=[];for(let n=0;n<t;n++)this.days.push({date:a-t+n+1,month:0===this.month?11:this.month-1,year:0===this.month?this.year-1:this.year,row:0,col:n,otherMonth:!0,selected:!1});for(let n=0;n<r;n++)this.days.push({date:n+1,month:this.month,year:this.year,row:Math.floor((t+n)/7),col:(t+n)%7,otherMonth:!1,selected:!1});let c=1;for(let n=this.days[this.days.length-1].col+1;n<7;n++)this.days.push({date:c++,month:11===this.month?0:this.month+1,year:11===this.month?this.year+1:this.year,row:this.days[this.days.length-1].row,col:n,otherMonth:!0,selected:!1})}nextMonth(){this.month++,this.month>11&&(this.month=0,this.year++),this.updateDays()}prevMonth(){this.month--,this.month<0&&(this.month=11,this.year--),this.updateDays()}getMonthAndYear(){return`${["January","February","March","April","May","June","July","August","September","October","November","December"][this.month]} ${this.year}`}isToday(t){return t.date===this.today.getDate()&&t.month===this.today.getMonth()&&t.year===this.today.getFullYear()}isDateInDb(t,r,a){if(this.datesFromDb){let s=new Date;const c=new Date(t,r,a),n=Date.UTC(t,r,a);return(c.getFullYear()!==s.getFullYear()||c.getMonth()!==s.getMonth()||c.getDate()!==s.getDate())&&this.datesFromDb.map(h=>Date.UTC(h.getFullYear(),h.getMonth(),h.getDate())).includes(n)}return!1}}return(i=u).\u0275fac=function(t){return new(t||i)(e.Y36(b.K),e.Y36(O.p))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-routine-check"]],decls:1,vars:1,consts:[["class","block-grid","style","padding: 10px; margin-top: 10px;",4,"ngIf"],[1,"block-grid",2,"padding","10px","margin-top","10px"],[2,"display","grid","grid-template-rows","1fr","grid-template-columns","1fr 50px"],[1,"heading",2,"grid-row","1","grid-column","1"],[1,"heading-circle",2,"grid-row","1","grid-column","2","display","flex","align-items","center","justify-content","center"],[2,"display","grid","grid-template-rows","1fr 1fr","grid-template-columns","150px 1fr 150px"],[2,"grid-row","1","grid-column","1","display","flex","align-items","center","justify-content","center","font-size","25px",3,"click"],[1,"fas","fa-arrow-left"],[1,"h2",2,"grid-row","1","grid-column","2","display","flex","align-items","center","justify-content","center",3,"click"],[2,"grid-row","1","grid-column","3","display","flex","align-items","center","justify-content","center","font-size","25px",3,"click"],[1,"fas","fa-arrow-right"],[1,"header-row",2,"display","grid","grid-template-columns","repeat(7, 1fr)"],["class","header-cal",4,"ngFor","ngForOf"],[2,"display","grid","grid-template-columns","repeat(7, 1fr)"],["class","day",3,"ngClass","click",4,"ngFor","ngForOf"],["class","selected-workouts",4,"ngIf"],[1,"header-cal"],[1,"day",3,"ngClass","click"],[1,"selected-workouts"],["class","workout-entry",3,"click",4,"ngFor","ngForOf"],[1,"workout-entry",3,"click"],[1,"workout-name"],[1,"edit-icon","fas"],[1,"workout-date"]],template:function(t,r){1&t&&e.YNc(0,U,18,5,"div",0),2&t&&e.Q6J("ngIf",r.datesFromDb)},dependencies:[x.mk,x.sg,x.O5,x.uU]}),u})();var P=w(2006);function H(i,u){if(1&i){const o=e.EpF();e.TgZ(0,"button",12),e.NdJ("click",function(){e.CHM(o);const r=e.oxw(4);return e.KtG(r.otherWeeks())}),e._uU(1),e.qZA()}if(2&i){const o=e.oxw(4);e.xp6(1),e.hij(" Start Week ",o.program.week," Workouts ")}}function Y(i,u){if(1&i){const o=e.EpF();e.TgZ(0,"div")(1,"button",12),e.NdJ("click",function(){e.CHM(o);const r=e.oxw(4);return e.KtG(r.createDeloadWeek())}),e._uU(2,"Start Deload Week"),e.qZA(),e.TgZ(3,"button",12),e.NdJ("click",function(){e.CHM(o);const r=e.oxw(4);return e.KtG(r.createNextMesocycle())}),e._uU(4,"Start Next Mesocycle"),e.qZA()()}}function G(i,u){if(1&i){const o=e.EpF();e.TgZ(0,"div")(1,"button",12),e.NdJ("click",function(){e.CHM(o);const r=e.oxw(4);return e.KtG(r.createDeloadWeek())}),e._uU(2,"Start Deload Week"),e.qZA(),e.TgZ(3,"button",12),e.NdJ("click",function(){e.CHM(o);const r=e.oxw(4);return e.KtG(r.createNextBlock())}),e._uU(4,"Start Next Block"),e.qZA()()}}function Q(i,u){if(1&i){const o=e.EpF();e.TgZ(0,"div")(1,"button",12),e.NdJ("click",function(){e.CHM(o);const r=e.oxw(4);return e.KtG(r.createNextMesocycle())}),e._uU(2,"Start Next Mesocycle"),e.qZA()()}}function K(i,u){if(1&i){const o=e.EpF();e.TgZ(0,"div")(1,"button",12),e.NdJ("click",function(){e.CHM(o);const r=e.oxw(4);return e.KtG(r.createNextBlock())}),e._uU(2,"Start Next Block"),e.qZA()()}}function L(i,u){if(1&i&&(e.TgZ(0,"div"),e.YNc(1,H,2,1,"button",11),e.YNc(2,Y,5,0,"div",1),e.YNc(3,G,5,0,"div",1),e.YNc(4,Q,3,0,"div",1),e.YNc(5,K,3,0,"div",1),e.qZA()),2&i){const o=e.oxw(3);e.xp6(1),e.Q6J("ngIf",o.program.week<=o.program.weeks&&0==o.sortedWorkouts[o.program.block-1].mesocycles[o.program.currentMesoCycle-1].weeks[o.program.week-1].workouts.length&&1==o.sortedWorkouts[o.program.block-1].mesocycles[o.program.currentMesoCycle-1].weeks[o.program.week-2].workouts[o.workoutLengthNumber-1].completed),e.xp6(1),e.Q6J("ngIf",o.program.week==o.program.weeks+1&&o.program.currentMesoCycle<o.program.mesocycle&&o.sortedWorkouts[o.program.block-1].mesocycles[o.program.currentMesoCycle-1].weeks[o.program.week-2].workouts[o.workoutLengthNumber-1].completed&&0==o.sortedWorkouts[o.program.block-1].mesocycles[o.program.currentMesoCycle-1].weeks[o.program.week-1].workouts.length),e.xp6(1),e.Q6J("ngIf",o.program.week==o.program.weeks+1&&o.program.mesocycle==o.program.currentMesoCycle&&o.sortedWorkouts[o.program.block-1].mesocycles[o.program.currentMesoCycle-1].weeks[o.program.week-2].workouts[o.workoutLengthNumber-1].completed),e.xp6(1),e.Q6J("ngIf",o.program.week==o.program.weeks+2&&o.program.mesocycle>o.program.currentMesoCycle&&o.sortedWorkouts[o.program.block-1].mesocycles[o.program.currentMesoCycle-1].weeks[o.program.week-2].workouts[o.workoutLengthNumber-1].completed),e.xp6(1),e.Q6J("ngIf",o.program.week==o.program.weeks+2&&o.program.mesocycle==o.program.currentMesoCycle&&o.sortedWorkouts[o.program.block-1].mesocycles[o.program.currentMesoCycle-1].weeks[o.program.week-2].workouts[o.workoutLengthNumber-1].completed)}}const C=function(i){return[i]};function j(i,u){if(1&i){const o=e.EpF();e.TgZ(0,"div",17),e.NdJ("click",function(){e.CHM(o);const r=e.oxw().index,a=e.oxw(4);return e.KtG(a.showBlocks(r))}),e._uU(1,"\uf060"),e.qZA()}if(2&i){const o=e.oxw().$implicit;e.Q6J("ngClass",e.VKq(1,C,o.weeks[0].workouts.length>0?"fas-week-label":"fas-week-label-disabled"))}}function V(i,u){if(1&i){const o=e.EpF();e.TgZ(0,"div",17),e.NdJ("click",function(){e.CHM(o);const r=e.oxw().index,a=e.oxw(4);return e.KtG(a.showBlocks(r))}),e._uU(1,"\uf063"),e.qZA()}if(2&i){const o=e.oxw().$implicit;e.Q6J("ngClass",e.VKq(1,C,o.weeks[0].workouts.length>0?"fas-week-label":"fas-week-label-disabled"))}}function $(i,u){if(1&i){const o=e.EpF();e.TgZ(0,"button",19),e.NdJ("click",function(){e.CHM(o);const r=e.oxw().index,a=e.oxw().index,s=e.oxw(4);return e.KtG(s.showWorkouts(a,r))}),e._uU(1),e.qZA()}if(2&i){const o=e.oxw().$implicit;e.Q6J("ngClass",e.VKq(3,C,o.show?"week-label-selected":"week-label"))("disabled",0===o.workouts.length),e.xp6(1),e.Oqu(o.name)}}function z(i,u){if(1&i){const o=e.EpF();e.TgZ(0,"button",19),e.NdJ("click",function(){e.CHM(o);const r=e.oxw().index,a=e.oxw().index,s=e.oxw(4);return e.KtG(s.showWorkouts(a,r))}),e._uU(1),e.qZA()}if(2&i){const o=e.oxw().$implicit;e.Q6J("ngClass",e.VKq(3,C,o.show?"week-label-selected":"week-label"))("disabled",0===o.workouts.length),e.xp6(1),e.Oqu(o.name)}}function X(i,u){if(1&i&&(e.TgZ(0,"div"),e.YNc(1,$,2,5,"button",18),e.YNc(2,z,2,5,"button",18),e.qZA()),2&i){const o=u.$implicit;e.xp6(1),e.Q6J("ngIf",!o.show),e.xp6(1),e.Q6J("ngIf",o.show)}}function ee(i,u){if(1&i&&(e.TgZ(0,"div",23),e._uU(1),e.qZA()),2&i){const o=e.oxw().$implicit,t=e.oxw(7);e.xp6(1),e.AsE(" Total Lifted: ",o.totalWeight," ",t.userSettings.kgs?"Kgs":"lbs"," ")}}function te(i,u){if(1&i){const o=e.EpF();e.TgZ(0,"div",21),e.NdJ("click",function(){const a=e.CHM(o).$implicit,s=e.oxw(7);return e.KtG(s.editWorkout(a.id))}),e.TgZ(1,"div",22),e._uU(2),e.qZA(),e.TgZ(3,"div",22),e._uU(4),e.ALo(5,"date"),e.qZA(),e.TgZ(6,"div",23),e._uU(7),e.qZA(),e.YNc(8,ee,2,2,"div",24),e.TgZ(9,"div",25),e._uU(10,"\uf054"),e.qZA()()}if(2&i){const o=u.$implicit;e.Q6J("ngClass",e.VKq(10,C,o.completed?"highlight-grid-completed":"highlight-grid")),e.xp6(2),e.AsE("Day ",o.day,". ",o.name,""),e.xp6(2),e.hij("Date: ",e.xi3(5,7,o.date,"fullDate"),""),e.xp6(3),e.hij("Time: ",o.totalTime,""),e.xp6(1),e.Q6J("ngIf",o.totalWeight),e.xp6(1),e.Q6J("ngClass",e.VKq(12,C,o.completed?"fas-check-completed":"fas-check-not-completed"))}}function oe(i,u){if(1&i&&(e.TgZ(0,"div"),e.YNc(1,te,11,14,"div",20),e.qZA()),2&i){const o=e.oxw().$implicit;e.xp6(1),e.Q6J("ngForOf",o.workouts)}}function re(i,u){if(1&i&&(e.TgZ(0,"div"),e.YNc(1,oe,2,1,"div",1),e.qZA()),2&i){const o=u.$implicit;e.xp6(1),e.Q6J("ngIf",o.workouts.length>0&&o.show)}}function se(i,u){if(1&i&&(e.TgZ(0,"div",2)(1,"div",14),e._uU(2),e.qZA(),e.YNc(3,j,2,3,"div",15),e.YNc(4,V,2,3,"div",15),e.TgZ(5,"div",5),e.YNc(6,X,3,2,"div",16),e.qZA(),e.YNc(7,re,2,1,"div",16),e.qZA()),2&i){const o=u.$implicit;e.xp6(2),e.Oqu(o.name),e.xp6(1),e.Q6J("ngIf",!o.show),e.xp6(1),e.Q6J("ngIf",o.show),e.xp6(2),e.Q6J("ngForOf",o.weeks),e.xp6(1),e.Q6J("ngForOf",o.weeks)}}function ie(i,u){if(1&i&&(e.TgZ(0,"div"),e.YNc(1,se,8,5,"div",13),e.qZA()),2&i){const o=e.oxw(3);e.xp6(1),e.Q6J("ngForOf",o.sortedWorkouts)}}function ne(i,u){if(1&i){const o=e.EpF();e.TgZ(0,"div")(1,"div",2)(2,"div",3),e.NdJ("click",function(){e.CHM(o);const r=e.oxw(2);return e.KtG(r.conLog())}),e._uU(3),e.qZA(),e.TgZ(4,"div",4),e.NdJ("click",function(){e.CHM(o);const r=e.oxw(2);return e.KtG(r.options())}),e._uU(5,"\uf013"),e.qZA()(),e.TgZ(6,"div",5)(7,"button",6),e.NdJ("click",function(){e.CHM(o);const r=e.oxw(2);return e.KtG(r.onSchemaInfo())}),e._uU(8,"Schema"),e.qZA(),e.TgZ(9,"button",6),e.NdJ("click",function(){e.CHM(o);const r=e.oxw(2);return e.KtG(r.viewDeloadModal(!0))}),e._uU(10,"Deload Week Rules"),e.qZA(),e.TgZ(11,"button",7),e.NdJ("click",function(){e.CHM(o);const r=e.oxw(2);return e.KtG(r.onViewNextMesoModal(!0))}),e._uU(12,"Next Meso Rules"),e.qZA(),e.TgZ(13,"button",6),e.NdJ("click",function(){e.CHM(o);const r=e.oxw(2);return e.KtG(r.onViewNextBlockModal())}),e._uU(14,"Next Block Rules"),e.qZA()(),e.TgZ(15,"div",5)(16,"div",8),e._uU(17,"Program Progress"),e.qZA(),e.TgZ(18,"div",9),e._uU(19,"Current Block"),e.qZA(),e.TgZ(20,"div",10),e._uU(21),e.qZA(),e.TgZ(22,"div",9),e._uU(23,"Current Mesocycle"),e.qZA(),e.TgZ(24,"div",10),e._uU(25),e.qZA(),e.TgZ(26,"div",9),e._uU(27,"Mesoscyles Length"),e.qZA(),e.TgZ(28,"div",10),e._uU(29),e.qZA()(),e.YNc(30,L,6,5,"div",1),e.YNc(31,ie,2,1,"div",1),e.qZA()}if(2&i){const o=e.oxw(2);e.xp6(3),e.hij(" ",o.program.name," "),e.xp6(8),e.Q6J("disabled",!o.program.runMeso),e.xp6(10),e.Oqu(o.program.block),e.xp6(4),e.AsE("",o.program.currentMesoCycle," / ",o.program.mesocycle,""),e.xp6(4),e.hij("",o.program.weeks," weeks"),e.xp6(1),e.Q6J("ngIf",o.sortedWorkouts&&o.program.runMeso),e.xp6(1),e.Q6J("ngIf",o.sortedWorkouts&&!o.program.runMeso)}}function ae(i,u){if(1&i&&(e.TgZ(0,"div"),e.YNc(1,ne,32,8,"div",1),e.qZA()),2&i){const o=e.oxw();e.ekj("page",!o.parentData),e.xp6(1),e.Q6J("ngIf",o.program)}}let ce=(()=>{var i;class u{constructor(t,r,a,s){this.programService=t,this.router=r,this.userService=a,this.route=s,this.noDownload=!1,this.newProgram=!1,this.isLoading=!0,this.isCreating=!1,this.creatingNewBlock=!1,this.workoutsLength="*,",this.workoutLengthNumber=0,this.route.queryParams.subscribe(c=>{this.newProgram=c.newProgram,this.info=c.info,this.programId=c.programId,this.finishedProgram=c.finishedProgram})}ngOnInit(){this.userService.currentUser.subscribe(t=>this.userSettings=t),this.parentData?(this.programService.getProgramHistory(this.parentData.programId),this.getProgramHistory()):this.getProgram()}ngOnDestroy(){console.log("On Destory"),this.parentData=null,this.programSub.unsubscribe()}conLog(){console.log(this.program)}getProgram(){this.programSub=this.programService.currentProgram.subscribe(t=>{if(t){this.program=t,this.sortWorkouts();for(let s=0;s<t.workouts.length;s++)this.workoutsLength=this.workoutsLength.concat("*,");let a=this.program.workouts.filter(s=>s.week===this.program.week-1&&s.meso===this.program.currentMesoCycle).every(s=>!0===s.completed);console.log("allTrue",a),setTimeout(()=>{"block"==this.info&&this.createNextBlock(),"deload"==this.info&&this.createDeloadWeek(),"finish"==this.info&&this.finishProgram(),"workouts"==this.info&&this.otherWeeks()},1e3)}})}getProgramHistory(){this.programSub=this.programService.currentProgramHistory.subscribe(t=>{if(t){this.program=t,this.sortWorkouts();for(let r=0;r<t.workouts.length;r++)this.workoutsLength=this.workoutsLength.concat("*,")}})}options(){}finishProgram(){this.info=null,this.isLoading=!0,this.noDownload=!0,this.programService.updateFinalProgram({Completed:!0},this.program.id,!0,this.userSettings.id),this.router.navigate(["home"],{})}deleteProgram(){this.isLoading=!0,this.noDownload=!0,console.log("True Deleting program"),this.programService.deleteCurrentProgram(this.program.id,!0,this.userSettings.id,!0),setTimeout(()=>{this.router.navigate(["home"],{})},2e3)}onSchemaInfo(){}otherWeeks(){this.info=null,this.isLoading=!0,this.creatingNewBlock=!0,1==this.program.block?(console.log("block 1",this.program.id),this.programService.getCurrentProgramWeeksWorkouts(this.program.id,this.program.week-1,this.program.block).subscribe(t=>{this.newProgramWorkouts=t,this.createOtherWeeksWorkouts()})):(console.log("other weeks past block 1"),this.programService.getCurrentProgramWeeksWorkouts(this.program.id,this.program.week-1,this.program.block).subscribe(t=>{this.newProgramWorkouts=t,console.log(t),this.createOtherWeeksWorkouts()}))}createOtherWeeksWorkouts(){this.updateProgramOverviewJSON(),console.log("Updating Properties"),this.updateProperties(),this.programService.postNewRoutineWorkoutsArray(this.newProgramWorkouts).subscribe(t=>{console.log("Elapsed time",t),this.updateRoutineBlockNextWeek()},t=>{console.log("Error"),console.error(t),this.isLoading=!1},()=>{})}updateRoutineBlockNextWeek(){let t={meso:this.program.currentMesoCycle,block:this.program.block,week:this.program.week+1,exerciseJSONstring:JSON.stringify(this.program.initialExercisesJSON),nextBlockJSONstring:JSON.stringify(this.program.nextBlockJSON),programOverviewJSONstring:JSON.stringify(this.program.programOverviewJSON)};this.newProgramWorkouts=[],this.programService.updateRoutineBlock(this.program.id,t)}updateProgramOverviewJSON(){if(0===Object.keys(this.program.programOverviewJSON).length&&this.program.programOverviewJSON.constructor===Object){console.log("Object is empty"),this.program.programOverviewJSON.weeks=[{week:1,block:1,totalWeight:"",totalSets:"",totalReps:"",totalTime:"",workouts:[]}];let r=0,a=0,s=0,c="00:00:00";this.newProgramWorkouts.forEach(n=>{c=this.addTimes(n.totalTime,c),r=parseFloat(n.totalWeight)+r,a=parseFloat(n.totalSets)+a,s=parseFloat(n.totalReps)+s,console.log("workout.totalWeight",n.totalTime);const g={workoutName:n.name,totalTime:n.totalTime,totalWeight:n.totalWeight,totalSets:n.totalSets,totalReps:n.totalReps};this.program.programOverviewJSON.weeks[0].totalWeight=r,this.program.programOverviewJSON.weeks[0].totalSets=a,this.program.programOverviewJSON.weeks[0].totalReps=s,this.program.programOverviewJSON.weeks[0].totalTime=c,this.program.programOverviewJSON.weeks[0].workouts.push(g)})}else{let t={week:this.program.week-1,block:this.program.block,totalWeight:"",totalSets:"",totalReps:"",totalTime:"",workouts:[]},r=0,a=0,s=0,c="00:00:00";this.newProgramWorkouts.forEach(n=>{c=this.addTimes(n.totalTime,c),r=parseFloat(n.totalWeight)+r,a=parseFloat(n.totalSets)+a,s=parseFloat(n.totalReps)+s;const g={workoutName:n.name,totalTime:n.totalTime,totalWeight:n.totalWeight,totalSets:n.totalSets,totalReps:n.totalReps};t.totalWeight=r.toString(),t.totalSets=a.toString(),t.totalReps=s.toString(),t.totalTime=c.toString(),t.workouts.push(g)}),this.program.programOverviewJSON.weeks.push(t)}}addTimes(t,r){const a=t.split(":").map(Number),s=r.split(":").map(Number),g=3600*a[0]+60*a[1]+a[2]+(3600*s[0]+60*s[1]+s[2]),l=Math.floor(g/3600),h=Math.floor(g%3600/60),p=g%60;return[l.toString().padStart(2,"0"),h.toString().padStart(2,"0"),p.toString().padStart(2,"0")].join(":")}onViewNextBlockModal(){}onViewNextMesoModal(t){console.log(t)}viewDeloadModal(t){console.log(this.program.multipliersJSON);let r=!1;this.program.multipliersJSON.forEach(a=>{"1RM"==a.type&&(r=!0)})}createNextMesocycle(){console.log("creating next mesocycle"),this.isLoading=!0,this.programService.getCurrentProgramCurrentMesoBaseWorkouts(this.program.id,1,this.program.block,this.program.currentMesoCycle).subscribe(t=>{this.newProgramWorkouts=t,this.nextMesocycleJSON()},t=>{console.log("Error"),console.error(t)})}nextMesocycleJSON(){let t=[];this.newProgramWorkouts.forEach(c=>c.segments.forEach(n=>{t.includes(n.exerciseName)||t.push(n.exerciseName)}));let r=[];this.program.nextMesoJSON.exercises.forEach(c=>{r.push(c.name)});let a=t.filter(c=>r.indexOf(c)<0),s=r.filter(c=>t.indexOf(c)<0);(a.length>0||s.length>0)&&(a&&a.forEach(c=>{this.program.nextMesoJSON.exercises.push({name:c,show:!1,increaseWeight:"",increaseReps:"",setOptions:""})}),s&&s.forEach(c=>{this.program.nextMesoJSON.exercises.forEach((n,g)=>{n.name===c&&this.program.nextMesoJSON.exercises.splice(g,1)})})),a=[],s=[],this.program.nextMesoJSON.exercises.forEach((c,n)=>{c.show=!1,1==c.oneRm&&(this.program.nextMesoJSON.exercises.splice(n,1),this.program.nextMesoJSON.exercises.unshift(c))}),this.onViewNextMesoModal(!1)}nextMesocycleWorkouts(){this.updateProgramOverviewJSON(),this.nextMesoPreChecks(),this.programService.postNewRoutineWorkoutsArray(this.newProgramWorkouts).subscribe(t=>{console.log("Elapsed time",t),this.updateRoutineMeso()},t=>{console.log("Error"),console.error(t)})}updateRoutineMeso(){let t={meso:this.program.currentMesoCycle+1,week:2,nextMesoJSONstring:JSON.stringify(this.program.nextBlockJSON)};this.newProgramWorkouts=[],this.programService.updateRoutineMeso(this.program.id,t)}nextMesoPreChecks(){let t=[],r=[],a=!1;for(var s of(this.program.workouts.forEach(l=>{l.meso===this.program.currentMesoCycle&&l.block===this.program.block&&(l.deload&&(a=!0,r.push(l.date)),!l.deload&&l.week==this.program.weeks&&t.push(l.date))}),this.newProgramWorkouts)){let l;s.segments.sort((p,d)=>p.name-d.name),s.segments.forEach(function(p){p.sets.sort((d,m)=>d.name-m.name)}),l=a?r.map(p=>new Date(p)):t.map(p=>new Date(p));const h=new Date(Math.min.apply(null,l.map(p=>p.getTime())));for(var c of(h.setDate(h.getDate()+(s.day-1+7)),s.date=h,s.deload=!1,s.meso=this.program.currentMesoCycle+1,s.baseWorkout=!0,s.week=1,s.userId=this.userSettings.userId,s.routineId=this.userSettings.routineId,s.completed=!1,s.routineId=+s.routineId,s.totalWeight="0",s.totalSets="0",s.totalReps="0",s.totalTime="00:00:00",delete s.id,s.segments))for(var n of(c.name=+c.name,delete c.id,c.sets)){n.name=+n.name,delete n.id,n.success=!1;try{let p,d,m,v,S=this.program.nextMesoJSON.exercises.findIndex(_=>_.name==c.exerciseName);if(m=this.program.nextMesoJSON.exercises[S],p=m.increaseWeight,d=m.increaseReps,m.oneRm){let _=this.program.initialExercisesJSON.exercises.findIndex(k=>k.exerciseName==c.exerciseName);if(!0===this.program.initialExercisesJSON.perctBool&&(v=parseFloat(m.currentOneRm)+parseFloat(p),this.program.initialExercisesJSON.exercises[_].perctWeight=v),!1===this.program.initialExercisesJSON.perctBool&&(v=parseFloat(m.currentOneRm)+parseFloat(p),this.program.initialExercisesJSON.exercises[_].currentWeight=v),!0===this.program.initialExercisesJSON.perctBool)var g=v*(n.rm/100);!1===this.program.initialExercisesJSON.perctBool&&(g=v*(n.rm/100),console.log(g));let f=this.roundToNearest(g,this.program.rounding);if(n.weight=f.toString(),d){let k=parseFloat(n.reps)+parseFloat(d);isNaN(k)?console.log("nan",k,"set.reps",n.reps,"new increment reps",d):n.reps=k.toString()}}else{if(p){let _=parseFloat(n.weight)+parseFloat(p);isNaN(_)?console.log("nan",_,"set.weight",n.weight,"new weight",p):n.weight=_.toString()}if(d){let _=parseFloat(n.reps)+parseFloat(d);isNaN(_)?console.log("nan",_,"set.reps",n.reps,"new Reps",d):n.reps=_.toString()}}}catch(p){console.error(p)}}}console.log("Pre checks done")}createDeloadWeek(){let t,r;this.isLoading=!0,this.creatingNewBlock=!0,this.program.runMeso&&(t=this.program.currentMesoCycle,r=this.program.deloadJSON.meso.week),console.log("meso",t,"week",r),this.programService.getCurrentProgramMesoWeeksWorkouts(this.program.id,r,t,this.program.block).subscribe(a=>{console.log(a),this.newProgramWorkouts=a,a&&this.deloadWeekWorkouts()},a=>{console.log("Error"),console.error(a)})}deloadWeekWorkouts(){this.updateProgramOverviewJSON(),this.newProgramWorkouts.forEach(t=>{delete t.id,t.routineId=+t.routineId,t.deload=!0,t.week=this.program.week,t.block=this.program.block,t.meso=this.program.currentMesoCycle,t.completed=!1,t.totalTime="00:00:00",t.totalWeight="0",t.totalSets="0",t.totalReps="0";const r=7*this.program.weeks,a=new Date(t.date);a.setHours(0,0,0,0),a.setDate(a.getDate()+(r+1)),t.date=a,t.day=t.day+r,t.segments.forEach(s=>{delete s.id,s.name=+s.name,s.sets.forEach(c=>{if(delete c.id,c.name=+c.name,c.success=!1,isNaN(c.weight))console.log("nan",c.weight);else{let n=parseFloat(c.weight)*(this.program.deloadJSON.meso.weightPerct/100),g=this.roundToNearest(n,this.program.rounding);c.weight=g.toString()}if(!isNaN(c.reps)){let n;this.program.deloadJSON.meso.repsPerctBool&&(n=parseFloat(c.reps)*(this.program.deloadJSON.meso.repsPerct/100)),this.program.deloadJSON.meso.repsNumberBool&&(n=parseFloat(c.reps)+this.program.deloadJSON.meso.reps);let g=this.roundToNearest(n,1);c.reps=g.toString()}})})}),this.saveDeloadWorkouts()}saveDeloadWorkouts(){this.programService.postNewRoutineWorkoutsArray(this.newProgramWorkouts).subscribe(t=>{console.log("Elapsed time",t),this.updateRoutineBlockNextWeek()},t=>{console.log("Error"),console.error(t),this.isLoading=!1},()=>{})}createNextBlock(){this.info="null",this.getCurrentProgramWeekBaseWorkouts(),this.isLoading=!0}getCurrentProgramWeekBaseWorkouts(){this.program.runMeso||this.programService.getCurrentProgramBaseWorkouts(this.program.id,1,this.program.block).subscribe(t=>{this.newProgramWorkouts=t,console.log("Retrived workouts",t.length,t),this.nextBlockJSONCheck()},t=>{console.log("Error"),console.error(t)}),this.program.runMeso&&this.programService.getCurrentProgramMesoWeeksWorkouts(this.program.id,1,1,this.program.block).subscribe(t=>{this.newProgramWorkouts=t,console.log("Retrived workouts",t.length,t),this.nextBlockJSONCheck()},t=>{console.log("Error"),console.error(t)})}nextBlockJSONCheck(){let t=[];this.newProgramWorkouts.forEach(l=>l.segments.forEach(h=>{t.some(p=>p.exName===h.exerciseName)||t.push({exName:h.exerciseName,exType:h.exerciseType})})),console.log("allExercises",t);const r=t.reduce((l,h)=>(l.some(p=>p.exName===h.exName)||l.push(h),l),[]);let a=r.map(l=>l.exName),s=[];this.program.nextBlockJSON.exercises.forEach(l=>{s.push(l.name)});let c=a.filter(l=>s.indexOf(l)<0),n=s.filter(l=>a.indexOf(l)<0),g=[];c.length>0&&c.forEach(l=>{const h=r.find(p=>p.exName===l);g.push(h)}),(c.length>0||n.length>0)&&(c&&g.forEach(l=>{this.program.nextBlockJSON.exercises.push({name:l.exName,type:l.exType,show:!1,oneRm:!1,increaseWeight:"",increaseReps:"",currentOneRm:"",setOptions:""})}),n&&n.forEach(l=>{this.program.nextBlockJSON.exercises.forEach((h,p)=>{h.name===l&&this.program.nextBlockJSON.exercises.splice(p,1)})})),this.program.initialExercisesJSON.exercises.forEach(l=>{this.program.nextBlockJSON.exercises.forEach((h,p)=>{1==h.oneRm&&(this.program.initialExercisesJSON.exercises.some(d=>d.exerciseName==h.name)||(this.program.nextBlockJSON.exercises[p].oneRm=!1)),l.exerciseName==h.name&&0==h.oneRm&&(this.program.nextBlockJSON.exercises[p].currentOneRm=l.startingWeight,this.program.nextBlockJSON.exercises[p].oneRm=!0)})}),this.program.nextBlockJSON.exercises.sort((l,h)=>l.type>h.type?1:-1),this.program.nextBlockJSON.exercises.sort(({oneRm:l=!1},{oneRm:h=!1})=>Number(h)-Number(l)),c=[],n=[],this.nextBlockModal(!1)}nextBlockModal(t){}nextBlock(){this.updateProgramOverviewJSON(),this.nextBlockPreChecks(),this.programService.postNewRoutineWorkoutsArray(this.newProgramWorkouts).subscribe(t=>{console.log("Elapsed time",t),this.programService.updateUserSettingsRoutineId(this.program.id,!1,this.userSettings.totalWorkouts,0,this.userSettings.id),this.updateNextRoutineBlock()},t=>{console.log("Error"),console.error(t)})}updateNextRoutineBlock(){let t={meso:1,block:this.program.block+1,week:2,exerciseJSONstring:JSON.stringify(this.program.initialExercisesJSON),nextBlockJSONstring:JSON.stringify(this.program.nextBlockJSON)};this.programService.updateRoutineBlock(this.program.id,t)}nextBlockPreChecks(){let t=[],r=[],a=!1;for(var s of(this.program.workouts.forEach(l=>{this.program.runMeso&&l.meso===this.program.currentMesoCycle&&l.block===this.program.block&&(l.deload&&(a=!0,r.push(l.date)),!l.deload&&l.week==this.program.weeks&&t.push(l.date)),this.program.runMeso||l.block===this.program.block&&(l.deload&&this.program.mesocycle==this.program.currentMesoCycle&&(a=!0,r.push(l.date)),!l.deload&&l.week==this.program.weeks&&this.program.mesocycle==this.program.currentMesoCycle&&t.push(l.date))}),this.newProgramWorkouts)){let l;s.segments.sort((p,d)=>p.name-d.name),s.segments.forEach(function(p){p.sets.sort((d,m)=>d.name-m.name)}),l=a?r.map(p=>new Date(p)):t.map(p=>new Date(p));const h=new Date(Math.min.apply(null,l.map(p=>p.getTime())));for(var c of(h.setDate(h.getDate()+(s.day-1+7)),console.log(h),console.log(s.date),s.date=h,this.program.runMeso&&(s.meso=1),s.completed=!1,s.baseWorkout=!0,s.block=this.program.block+1,s.week=1,s.userId=this.userSettings.userId,s.routineId=this.userSettings.routineId,s.routineId=+s.routineId,s.totalWeight="0",s.totalSets="0",s.totalReps="0",s.totalTime="00:00:00",delete s.id,s.segments))for(var n of(c.name=+c.name,delete c.id,c.sets)){n.name=+n.name,delete n.id,n.success=!1;try{let p,d,m,v,S=this.program.nextBlockJSON.exercises.findIndex(_=>_.name==c.exerciseName);if(m=this.program.nextBlockJSON.exercises[S],p=m.increaseWeight,d=m.increaseReps,m.oneRm){let _=this.program.initialExercisesJSON.exercises.findIndex(k=>k.exerciseName==c.exerciseName);if(!0===this.program.initialExercisesJSON.perctBool&&(v=parseFloat(m.currentOneRm)+parseFloat(p),this.program.initialExercisesJSON.exercises[_].perctWeight=v),!1===this.program.initialExercisesJSON.perctBool&&(v=parseFloat(m.currentOneRm)+parseFloat(p),this.program.initialExercisesJSON.exercises[_].currentWeight=v),!0===this.program.initialExercisesJSON.perctBool)var g=v*(n.rm/100);!1===this.program.initialExercisesJSON.perctBool&&(g=v*(n.rm/100),console.log(g));let f=this.roundToNearest(g,this.program.rounding);if(n.weight=f.toString(),d){let k=parseFloat(n.reps)+parseFloat(d);isNaN(k)?console.log("nan",k,"set.reps",n.reps,"new increment reps",d):n.reps=k.toString()}}else{if(p){let _=parseFloat(n.weight)+parseFloat(p);isNaN(_)?console.log("nan",_,"set.weight",n.weight,"new weight",p):n.weight=_.toString()}if(d){let _=parseFloat(n.reps)+parseFloat(d);isNaN(_)?console.log("nan",_,"set.reps",n.reps,"new Reps",d):n.reps=_.toString()}}}catch(p){console.error(p)}}}console.log("Pre checks done")}updateProperties(){let r,a=0;for(var s of this.newProgramWorkouts){s.segments.sort((p,d)=>p.name-d.name),s.segments.forEach(function(p){p.sets.sort((d,m)=>d.name-m.name)}),delete s.id,s.day=s.day+7;const l=new Date(s.date);let h;for(var c of(l.setHours(0,0,0,0),l.setDate(l.getDate()+8),s.date=l,s.userId=this.userSettings.userId,s.routineId=this.userSettings.routineId,s.week=s.week+1,s.baseWorkout=!1,s.completed=!1,s.routineId=+s.routineId,s.totalWeight="0",s.totalSets="0",s.totalReps="0",s.totalTime="00:00:00",s.rules&&(h=JSON.parse(s.rules)),s.segments))for(var n of(delete c.id,a=0,c.name=+c.name,c.sets)){if(delete n.id,n.name=+n.name,n.success=!1,n.previousReps=n.reps,n.previousWeight=n.weight,n.setRules){let p=JSON.parse(n.setRules),d=h.topSet.find(S=>S.name==p.type);n.reps=d.repRanges.start;let m=parseFloat(n.weight)+parseFloat(p.increaseWeight),v=this.roundToNearest(m,this.program.rounding);n.weight=v.toString()}for(var g=0;g<15;g++)this.program.multipliersJSON&&this.program.multipliersJSON.forEach(p=>{if(0!==p.setMultipliers.length&&n.name==g+1&&n.type==p.type){let _=this.program.multipliersJSON.find(f=>f.type===n.type);r=n.type;try{n.type!=r&&(a=0);var d=_.setMultipliers.find(f=>parseFloat(f.name)===s.week).reps[a],m=_.setMultipliers.find(f=>parseFloat(f.name)===s.week).weights[a],v=_.setMultipliers.find(f=>parseFloat(f.name)===s.week).oneRms[a];a+=1}catch{}if(d)if(isNaN(d))console.log(d),n.reps=d;else{let f=parseFloat(n.reps)+parseFloat(d);n.reps=f.toString()}if(m){let f=parseFloat(n.weight)+parseFloat(m),k=this.roundToNearest(f,this.program.rounding);n.weight=k.toString()}v&&(n.rm=parseFloat(v));try{if("1RM"===n.type){let f,k;if(1==this.program.block&&(k=this.program.initialExercisesJSON.exercises.find(N=>N.exerciseName===c.exerciseName)),this.program.block>1&&(console.log(this.program.nextBlockJSON),k=this.program.nextBlockJSON.exercises.find(N=>N.name===c.exerciseName),console.log("past block one",k)),!0===this.program.initialExercisesJSON.perctBool&&(f=this.program.block>1?k.currentOneRm:k.perctWeight),!1===this.program.initialExercisesJSON.perctBool&&(f=this.program.block>1?k.currentOneRm:k.startingWeight,console.log("Set weight",f)),f){var S=parseFloat(f)*(n.rm/100);let N=this.roundToNearest(S,this.program.rounding);n.weight=N.toString()}f||console.log("No SetWeight")}"AMAP"===n.reps&&(n.showPrev=!0)}catch(f){console.error(f)}}})}}}roundToNearest(t,r){return Math.round(t/r)*r}sortWorkouts(){this.sortedWorkouts=[];var t=[];if(this.program.runMeso){for(var r=0;r<this.program.block;r++){let g={id:r+1,name:"Block "+(r+1).toString(),show:!1,mesocycles:[]};g.id==this.program.block&&(g.show=!0),t.push(g);for(var a=0;a<this.program.mesocycle;a++){let l={id:a+1,name:"Mesocycle "+(a+1).toString(),show:!1,weeks:[]};t[r].mesocycles.push(l);for(var s=0;s<this.program.weeks+1;s++){let h={id:s+1,name:"Week "+(s+1).toString(),block:(r+1).toString(),show:!1,deload:!1,workouts:[]};s==this.program.weeks&&(h.deload=!0,h.name="Week "+(s+1)+" Deload Week".toString()),t[r].mesocycles[a].weeks.push(h)}}}for(var c=0;c<this.program.workouts.length;c++){var n=this.program.workouts[c];t.forEach(g=>{g.mesocycles.forEach(l=>{l.weeks.forEach(h=>{if(h.id==n.week&&h.block==n.block&&n.meso==l.id)try{h.workouts.push(n)}catch{console.log("error")}})})})}t.forEach(g=>{g.mesocycles.forEach(l=>{l.weeks.forEach(h=>{h.workouts.sort((p,d)=>p.day-d.day)})})}),t[this.program.block-1].show=!0,t[this.program.block-1].mesocycles[this.program.currentMesoCycle-1].show=!0,this.sortedWorkouts=t,this.workoutLengthNumber=t[0].mesocycles[0].weeks[0].workouts.length}if(!this.program.runMeso){for(console.log("not run meso",this.program.weeks),r=0;r<this.program.block;r++){let l={id:r+1,name:"Block "+(r+1).toString(),show:!1,weeks:[]};for(t.push(l),a=0;a<this.program.weeks+1;a++){let p={id:a+1,name:"Week "+(a+1).toString(),block:(r+1).toString(),show:!1,deload:!1,workouts:[]};a==this.program.weeks&&(p.deload=!0,p.name="Week "+(a+1)+" Deload Week".toString()),t[r].weeks.push(p)}for(c=0;c<this.program.workouts.length;c++)n=this.program.workouts[c],t.forEach(d=>{d.weeks.forEach(m=>{if(m.id==n.week&&m.block==n.block&&"Deload"!=n.type)try{m.workouts.push(n)}catch{console.log("error")}})})}t.forEach(g=>{g.weeks.forEach(function(l){l.workouts.sort((h,p)=>h.day-p.day)})}),t[this.program.block-1].show=!0,this.sortedWorkouts=t,this.workoutLengthNumber=t[0].weeks[0].workouts.length}this.isLoading=!1}showBlocks(t){this.sortedWorkouts[t].show=!this.sortedWorkouts[t].show}showMesos(t,r){this.sortedWorkouts[t].mesocycles[r].show=!this.sortedWorkouts[t].mesocycles[r].show}showWorkouts(t,r){this.sortedWorkouts[t].weeks.forEach(a=>{a.show=!1}),this.sortedWorkouts[t].weeks[r].show=!this.sortedWorkouts[t].weeks[r].show}showMesoWorkouts(t,r,a){this.sortedWorkouts[t].mesocycles[r].weeks.forEach(s=>{s.show=!1}),this.sortedWorkouts[t].mesocycles[r].weeks[a].show=!this.sortedWorkouts[t].mesocycles[r].weeks[a].show}showDeloadWorkouts(t,r){console.log(r,this.sortedWorkouts[r].show),this.sortedWorkouts[t].deload[r].show=!this.sortedWorkouts[t].deload[r].show}editWorkout(t){let r={relativeTo:this.route,queryParams:{workoutId:t,isEditing:!0,finishedProgram:!0}};this.router.navigate(["../new-workout"],r).catch(a=>{this.router.navigate(["../workout/new-workout"],r)})}}return(i=u).\u0275fac=function(t){return new(t||i)(e.Y36(O.p),e.Y36(T.F0),e.Y36(b.K),e.Y36(T.gz))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-current-routine"]],inputs:{parentData:"parentData"},decls:1,vars:1,consts:[[3,"page",4,"ngIf"],[4,"ngIf"],[1,"grid-layout"],[1,"header-label",3,"click"],[1,"fas",3,"click"],[1,"block-grid"],[1,"week-label",3,"click"],[1,"week-label",3,"disabled","click"],[1,"heading-2"],[1,"heading-1"],[1,"heading-1-text"],["class","button",3,"click",4,"ngIf"],[1,"button",3,"click"],["class","grid-layout",4,"ngFor","ngForOf"],[1,"h2"],["class","fas",3,"ngClass","click",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"fas",3,"ngClass","click"],[3,"ngClass","disabled","click",4,"ngIf"],[3,"ngClass","disabled","click"],[3,"ngClass","click",4,"ngFor","ngForOf"],[3,"ngClass","click"],[1,"h3"],[1,"paragraph"],["class","paragraph",4,"ngIf"],[1,"fas",3,"ngClass"]],template:function(t,r){1&t&&e.YNc(0,ae,2,3,"div",0),2&t&&e.Q6J("ngIf",!r.isLoading)},dependencies:[x.mk,x.sg,x.O5,x.uU]}),u})(),le=(()=>{var i;class u{constructor(t,r){this.route=t,this.router=r}ngOnInit(){}onNewWorkout(){this.router.navigate(["new-workout"],{relativeTo:this.route,queryParams:{newWorkout:!0}})}}return(i=u).\u0275fac=function(t){return new(t||i)(e.Y36(T.gz),e.Y36(T.F0))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-workout"]],decls:2,vars:0,consts:[[1,"button",3,"click"]],template:function(t,r){1&t&&(e.TgZ(0,"button",0),e.NdJ("click",function(){return r.onNewWorkout()}),e._uU(1,"Start a workout"),e.qZA())},encapsulation:2}),u})();function pe(i,u){if(1&i){const o=e.EpF();e.TgZ(0,"div",2)(1,"button",3),e.NdJ("click",function(){e.CHM(o);const r=e.oxw(2);return e.KtG(r.changeGraphData("totalReps"))}),e._uU(2,"Total Reps"),e.qZA(),e.TgZ(3,"button",3),e.NdJ("click",function(){e.CHM(o);const r=e.oxw(2);return e.KtG(r.changeGraphData("totalWeight"))}),e._uU(4,"Total Weight"),e.qZA(),e.TgZ(5,"button",3),e.NdJ("click",function(){e.CHM(o);const r=e.oxw(2);return e.KtG(r.changeGraphData("totalSets"))}),e._uU(6,"Total Sets"),e.qZA()()}if(2&i){const o=e.oxw(2);e.xp6(1),e.ekj("week-label-selected","totalReps"===o.graphType),e.xp6(2),e.ekj("week-label-selected","totalWeight"===o.graphType),e.xp6(2),e.ekj("week-label-selected","totalSets"===o.graphType)}}const y=function(i,u){return{positive:i,negative:u}};function ue(i,u){if(1&i&&(e.TgZ(0,"tr",13)(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td",14),e._uU(6),e.qZA(),e.TgZ(7,"td"),e._uU(8),e.qZA(),e.TgZ(9,"td",14),e._uU(10),e.qZA(),e.TgZ(11,"td"),e._uU(12),e.qZA(),e.TgZ(13,"td",14),e._uU(14),e.qZA(),e.TgZ(15,"td"),e._uU(16),e.qZA(),e.TgZ(17,"td",14),e._uU(18),e.qZA()()),2&i){const o=u.$implicit,t=e.oxw(4);e.xp6(2),e.Oqu(o.week),e.xp6(2),e.AsE("",o.totalWeight," ",t.userSettings.kgs?"Kgs":"lbs",""),e.xp6(1),e.Q6J("ngClass",e.WLB(14,y,o.weightIncrease>0,o.weightIncrease<0)),e.xp6(1),e.hij("",o.weightIncrease,"%"),e.xp6(2),e.Oqu(o.totalReps),e.xp6(1),e.Q6J("ngClass",e.WLB(17,y,o.repsIncrease>0,o.repsIncrease<0)),e.xp6(1),e.hij("",o.repsIncrease,"%"),e.xp6(2),e.Oqu(o.totalSets),e.xp6(1),e.Q6J("ngClass",e.WLB(20,y,o.setsIncrease>0,o.setsIncrease<0)),e.xp6(1),e.hij("",o.setsIncrease,"%"),e.xp6(2),e.Oqu(o.totalTime),e.xp6(1),e.Q6J("ngClass",e.WLB(23,y,o.timeIncrease>0,o.timeIncrease<0)),e.xp6(1),e.hij("",o.timeIncrease,"%")}}function he(i,u){if(1&i&&(e.ynx(0),e.TgZ(1,"h2",8),e._uU(2),e.qZA(),e.TgZ(3,"div",9)(4,"table",10)(5,"thead")(6,"tr")(7,"th",11),e._uU(8,"Week"),e.qZA(),e.TgZ(9,"th",11),e._uU(10,"Total Weight"),e.qZA(),e.TgZ(11,"th",11),e._uU(12,"Weight Increase (%)"),e.qZA(),e.TgZ(13,"th",11),e._uU(14,"Total Reps"),e.qZA(),e.TgZ(15,"th",11),e._uU(16,"Reps Increase (%)"),e.qZA(),e.TgZ(17,"th",11),e._uU(18,"Total Sets"),e.qZA(),e.TgZ(19,"th",11),e._uU(20,"Sets Increase (%)"),e.qZA(),e.TgZ(21,"th",11),e._uU(22,"Total Time"),e.qZA(),e.TgZ(23,"th",11),e._uU(24,"Time Increase (%)"),e.qZA()()(),e.TgZ(25,"tbody"),e.YNc(26,ue,19,26,"tr",12),e.qZA()()(),e.BQk()),2&i){const o=u.$implicit;e.xp6(2),e.Oqu(o.workoutname),e.xp6(24),e.Q6J("ngForOf",o.weeks)}}function ge(i,u){if(1&i&&(e.TgZ(0,"div"),e.YNc(1,he,27,2,"ng-container",6),e.TgZ(2,"div",7)(3,"p"),e._uU(4,"Notes:"),e.qZA(),e.TgZ(5,"p"),e._uU(6,"The percentage increases ignore deload weeks and are calculated to the week previous to the deload week."),e.qZA()()()),2&i){const o=e.oxw(2);e.xp6(1),e.Q6J("ngForOf",o.workoutTableData)}}function de(i,u){if(1&i){const o=e.EpF();e.TgZ(0,"div",1)(1,"div",2)(2,"button",3),e.NdJ("click",function(){e.CHM(o);const r=e.oxw();return e.KtG(r.changeGraphOptions("totals"))}),e._uU(3,"Totals"),e.qZA(),e.TgZ(4,"button",3),e.NdJ("click",function(){e.CHM(o);const r=e.oxw();return e.KtG(r.changeGraphOptions("workouts"))}),e._uU(5,"Workouts"),e.qZA()(),e.YNc(6,pe,7,6,"div",4),e.YNc(7,ge,7,1,"div",5),e.qZA()}if(2&i){const o=e.oxw();e.xp6(2),e.ekj("week-label-selected","totals"===o.graphOptions),e.xp6(2),e.ekj("week-label-selected","workouts"===o.graphOptions),e.xp6(2),e.Q6J("ngIf","totals"===o.graphOptions),e.xp6(1),e.Q6J("ngIf","workouts"===o.graphOptions)}}let me=(()=>{var i;class u{constructor(t,r){this.userService=t,this.routineService=r,this.isLoading=!0,this.graphOptions="workouts",this.graphYAxis="Reps",this.graphTitle="Total Reps",this.graphType="totalReps",this.workoutTableData=[]}ngOnInit(){this.userService.currentUser.subscribe(t=>{this.userSettings=t,setTimeout(()=>{this.getProgramOverview()},2e3)})}getProgramOverview(){this.graphData=this.routineService.graphData(),this.workoutTable(),this.isLoading=!1;const t=this.graphData.reduce((a,s)=>{const c=`week_${s.workoutWeek}_block_${s.workoutBlock}_meso_${s.workoutMeso}`,n=a.findIndex(g=>g.key===c);return n>=0?(a[n].totalReps+=parseFloat(s.totalReps),a[n].totalTime=this.addTimes(a[n].totalTime,s.totalTime),a[n].totalWeight+=parseFloat(s.totalWeight),a[n].totalSets+=parseInt(s.totalSets)):a.push({key:c,totalReps:parseFloat(s.totalReps),totalTime:s.totalTime,totalWeight:parseFloat(s.totalWeight),totalSets:parseInt(s.totalSets)}),a},[]);this.graphTotals=t;const r=this.graphType;this.currentGraphData=this.graphTotals.map((a,s)=>({index:s+1,value:parseFloat(a[r])}))}changeGraphOptions(t){"totals"==t&&(this.graphOptions="totals"),"workouts"==t&&(this.graphOptions="workouts")}workoutTable(){this.workoutTableData=[];const t=this.graphData.reduce((r,a)=>{const s=r.find(c=>c.workoutname===a.workoutName);return s?(s.deload.push(a.workoutDeload),s.totalTime.push(a.totalTime),s.totalWeight.push(a.totalWeight),s.totalSets.push(a.totalSets),s.totalReps.push(a.totalReps)):r.push({workoutname:a.workoutName,deload:[a.workoutDeload],totalTime:[a.totalTime],totalWeight:[a.totalWeight],totalSets:[a.totalSets],totalReps:[a.totalReps]}),r},[]);this.workoutGraphData=t,t.forEach((r,a)=>{let s={workoutname:r.workoutname,weeks:[]},c=0,n=0,g=0,l=0;r.totalTime.forEach((h,p)=>{const d=parseFloat(r.totalWeight[p]),m=parseFloat(r.totalSets[p]),v=parseFloat(r.totalReps[p]),S=0===p?"-":((this.timeToSeconds(h)-this.timeToSeconds(c))/this.timeToSeconds(c)*100).toFixed(2),_=0===p?"-":((d-n)/n*100).toFixed(2),f=0===p?"-":((m-g)/g*100).toFixed(2),k=0===p?"-":((v-l)/l*100).toFixed(2);s.weeks.push({week:p+1+(t[a].deload[p]?" Deload":""),totalTime:h,totalWeight:d,totalSets:m,totalReps:v,timeIncrease:S,weightIncrease:_,setsIncrease:f,repsIncrease:k}),c=h,n=t[a].deload[p]?n:d,g=m,l=v}),this.workoutTableData.push(s)})}rowsDefinition(){const t=this.workoutTableData.reduce((r,a)=>r+a.weeks.length+2,0);return Array(t).fill("*").join(", ")}getRows(t){return new Array(t.weeks.length+1).fill("*").join(",")}timeToSeconds(t){const[r,a,s]=t.split(":").map(Number);return 3600*r+60*a+s}changeGraphData(t){this.graphType=t,this.graphTitle={totalTime:"Total Time",totalSets:"Total Sets",totalWeight:"Total Weight",totalReps:"Total Reps"}[t],this.graphYAxis={totalTime:"Time",totalSets:"Sets",totalWeight:"Weight ("+(this.userSettings.kgs?"Kgs":"lbs")+")",totalReps:"Reps"}[t],console.log(t);const s=this.graphType;this.currentGraphData=this.graphTotals.map((c,n)=>({index:n+1,value:parseFloat(c[s])})),console.log(this.currentGraphData)}addTimes(t,r){const a=t.split(":").map(Number),s=r.split(":").map(Number),g=3600*a[0]+60*a[1]+a[2]+(3600*s[0]+60*s[1]+s[2]),l=Math.floor(g/3600),h=Math.floor(g%3600/60),p=g%60;return[l.toString().padStart(2,"0"),h.toString().padStart(2,"0"),p.toString().padStart(2,"0")].join(":")}}return(i=u).\u0275fac=function(t){return new(t||i)(e.Y36(b.K),e.Y36(O.p))},i.\u0275cmp=e.Xpm({type:i,selectors:[["ns-graphs"]],decls:1,vars:1,consts:[["style","margin-top: 50px;",4,"ngIf"],[2,"margin-top","50px"],[1,"grid-container"],[1,"week-label",3,"click"],["class","grid-container",4,"ngIf"],[4,"ngIf"],[4,"ngFor","ngForOf"],[1,"block-grid",2,"margin-top","20px"],[1,"heading"],[2,"overflow-x","auto"],[1,"block-grid",2,"margin","5px"],[1,"table-header"],["style","margin-top: 50px; text-align: center;",4,"ngFor","ngForOf"],[2,"margin-top","50px","text-align","center"],[3,"ngClass"]],template:function(t,r){1&t&&e.YNc(0,de,8,6,"div",0),2&t&&e.Q6J("ngIf",r.graphData)},dependencies:[x.mk,x.sg,x.O5],encapsulation:2}),u})();function _e(i,u){if(1&i){const o=e.EpF();e.TgZ(0,"div",4)(1,"button",5),e.NdJ("click",function(){const a=e.CHM(o).index,s=e.oxw(2);return e.KtG(s.changeScreen(a))}),e._uU(2),e.qZA()()}if(2&i){const o=u.$implicit;e.xp6(1),e.ekj("week-label-selected",o.selected),e.Q6J("disabled",!o.isEnabled),e.xp6(1),e.hij(" ",o.name," ")}}function fe(i,u){1&i&&(e.TgZ(0,"div"),e._UZ(1,"app-routine-check"),e.qZA())}function ke(i,u){1&i&&(e.TgZ(0,"div"),e._UZ(1,"app-routine-check"),e.qZA())}function ve(i,u){if(1&i&&(e.TgZ(0,"div"),e.YNc(1,fe,2,0,"div",0),e.YNc(2,ke,2,0,"div",0),e.qZA()),2&i){const o=e.oxw(3);e.xp6(1),e.Q6J("ngIf",o.userSettings.stillCreatingRoutine),e.xp6(1),e.Q6J("ngIf",!o.userSettings.stillCreatingRoutine)}}function xe(i,u){if(1&i&&(e.TgZ(0,"div")(1,"div"),e._UZ(2,"app-workout"),e.qZA(),e.YNc(3,ve,3,2,"div",0),e.qZA()),2&i){const o=e.oxw(2);e.xp6(3),e.Q6J("ngIf",o.userSettings)}}function we(i,u){1&i&&e._UZ(0,"app-routine-check")}function Se(i,u){1&i&&e._UZ(0,"ns-graphs")}function Te(i,u){1&i&&e._UZ(0,"app-current-routine",6)}function Ce(i,u){1&i&&e._UZ(0,"app-set-up-routine")}function Ne(i,u){1&i&&e._UZ(0,"app-create-routine")}function be(i,u){if(1&i&&(e.TgZ(0,"div")(1,"div",1),e.YNc(2,_e,3,4,"div",2),e.qZA(),e.TgZ(3,"div"),e.YNc(4,xe,4,1,"div",0),e.YNc(5,we,1,0,"app-routine-check",0),e.YNc(6,Se,1,0,"ns-graphs",0),e.YNc(7,Te,1,0,"app-current-routine",3),e.YNc(8,Ce,1,0,"app-set-up-routine",0),e.YNc(9,Ne,1,0,"app-create-routine",0),e.qZA()()),2&i){const o=e.oxw();e.xp6(2),e.Q6J("ngForOf",o.screensArr),e.xp6(2),e.Q6J("ngIf",o.screensArr[0].selected),e.xp6(1),e.Q6J("ngIf",o.screensArr[1].selected),e.xp6(1),e.Q6J("ngIf",o.screensArr[1].selected),e.xp6(1),e.Q6J("ngIf",o.screensArr[2].selected&&o.userSettings.routineId&&!o.userSettings.stillCreatingRoutine),e.xp6(1),e.Q6J("ngIf",o.screensArr[2].selected&&!o.userSettings.routineId&&o.userSettings.stillCreatingRoutine),e.xp6(1),e.Q6J("ngIf",o.screensArr[2].selected&&o.userSettings.routineId&&o.userSettings.stillCreatingRoutine)}}const ye=[{path:"",component:(()=>{var i;class u{constructor(t,r,a){this.router=t,this.userService=r,this.homePageService=a,this.screensArr=[{name:"Home",isEnabled:!0,selected:!0},{name:"Dashboard",isEnabled:!1,selected:!1},{name:"Program",isEnabled:!1,selected:!1},{name:"History",isEnabled:!0,selected:!1},{name:"Diet",isEnabled:!1,selected:!1}]}ngOnInit(){this.userService.currentUser.subscribe(t=>{t?(this.userSettings=t,this.screensArr=[{name:"Home",isEnabled:!0,selected:!0},{name:"Dashboard",isEnabled:!this.userSettings.stillCreatingRoutine,selected:!1},{name:"Program",isEnabled:!this.userSettings.stillCreatingRoutine,selected:!1},{name:"History",isEnabled:!0,selected:!1},{name:"Diet",isEnabled:!1,selected:!1}],this.userSettings.routineId&&!this.userSettings.stillCreatingRoutine&&(this.screensArr=this.screensArr.map(r=>({...r,selected:!1})),this.screensArr[1].selected=!0),(!this.userSettings.routineId&&this.userSettings.stillCreatingRoutine||this.userSettings.routineId&&this.userSettings.stillCreatingRoutine)&&(this.screensArr.splice(2,1,{name:"Create",isEnabled:this.userSettings.stillCreatingRoutine,selected:!1}),this.changeViewFuction())):(this.router.navigateByUrl(""),localStorage.clear())}),this.changeView=this.homePageService.changeView.subscribe(t=>{this.changeView=t,setTimeout(()=>{this.changeViewFuction()},1e3)})}changeViewFuction(){"Create"===this.changeView&&(this.screensArr=this.screensArr.map(t=>({...t,selected:!1})),this.screensArr[2].selected=!0),"History"===this.changeView&&(this.screensArr=this.screensArr.map(t=>({...t,selected:!1})),this.screensArr[3].selected=!0),"Home"===this.changeView&&(this.screensArr=this.screensArr.map(t=>({...t,selected:!1})),this.screensArr[0].selected=!0)}changeScreen(t){this.screensArr=this.screensArr.map(r=>({...r,selected:!1})),this.screensArr[t].selected=!0}}return(i=u).\u0275fac=function(t){return new(t||i)(e.Y36(T.F0),e.Y36(b.K),e.Y36(M))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-home"]],decls:1,vars:1,consts:[[4,"ngIf"],[1,"row"],["class","col",4,"ngFor","ngForOf"],["style","height: 100%;",4,"ngIf"],[1,"col"],[1,"week-label",3,"disabled","click"],[2,"height","100%"]],template:function(t,r){1&t&&e.YNc(0,be,10,7,"div",0),2&t&&e.Q6J("ngIf",r.userSettings)},dependencies:[B,P.l,ce,le,x.sg,x.O5,me],styles:[".flex-container[_ngcontent-%COMP%]{display:flex;align-items:stretch;background-color:#f1f1f1}.flex-container[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{background-color:#1e90ff;color:#fff;width:100px;margin:10px;text-align:center;line-height:75px;font-size:10px}"]}),u})()}];let Oe=(()=>{var i;class u{}return(i=u).\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[T.Bz.forChild(ye),T.Bz]}),u})();var We=w(3900),Ze=w(4402);let Je=(()=>{var i;class u{}return(i=u).\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[Ze.RoutineModule,We.WorkoutModule,Z.UX,Oe,Z.u5,x.ez]}),u})()}}]);